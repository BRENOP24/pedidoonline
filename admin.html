<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Área Admin Farmácia</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>

    <header>
        <h1>Painel de Administração da Farmácia</h1>
    </header>

    <div id="login-form">
        <h2>Acesso Administrativo</h2>
        <div class="input-group">
            <label for="admin-login">Login:</label>
            <input type="text" id="admin-login" placeholder="Login de Acesso">
        </div>
        <div class="input-group">
            <label for="admin-senha">Senha:</label>
            <input type="password" id="admin-senha" placeholder="Senha de Acesso">
        </div>
        <button onclick="fazerLogin()" style="width: 100%;">Entrar</button>
        <p style="margin-top: 15px; color: #dc3545; font-size: 0.9em;">
            *Login inicial: admin / admin123.
        </p>
    </div>

    <div id="admin-panel" style="display: none;">
        <h2>Gerenciar Produtos</h2>
        
        <fieldset>
            <legend id="produto-form-titulo">Adicionar Novo Produto</legend>
            <input type="hidden" id="produto-index-edicao"> 
            
            <div class="input-group">
                <label for="novo-nome">Nome do Produto:</label>
                <input type="text" id="novo-nome" placeholder="Ex: Paracetamol 500mg">
            </div>
            <div class="input-group">
                <label for="nova-categoria">Categoria:</label>
                <input type="text" id="nova-categoria" placeholder="Ex: Medicamentos, Higiene, Suplementos">
            </div>
            <div class="input-group">
                <label for="novo-preco">Preço (Use ponto, Ex: 12.50):</label>
                <input type="number" step="0.01" id="novo-preco" placeholder="0.00">
            </div>
            <div class="input-group">
                <label for="nova-url-imagem">URL da Imagem:</label>
                <input type="url" id="nova-url-imagem" placeholder="Ex: https://via.placeholder.com/150">
                <p style="font-size: 0.8em; color: #6c757d;">*Use um link público.</p>
            </div>
            <div class="input-group">
                <label for="nova-quantidade-estoque">Quantidade em Estoque:</label>
                <input type="number" id="nova-quantidade-estoque" placeholder="0" min="0">
            </div>

            <div class="status-group">
                <label for="novo-status">Status do Produto:</label>
                <select id="novo-status">
                    <option value="ativo">Ativo (Visível no Catálogo)</option>
                    <option value="inativo">Inativo (Oculto no Catálogo)</option>
                </select>
            </div>
            
            <button id="btn-submit-produto" onclick="adicionarProdutoAdmin()" style="width: 100%;">Cadastrar Produto</button>
            <button id="btn-cancelar-edicao" onclick="cancelarEdicao()" style="width: 100%; background-color: #6c757d; margin-top: 10px; display: none;">Cancelar Edição</button>
        </fieldset>

        <hr style="margin: 30px 0; border-top: 1px solid #ced4da;">

        <h3 style="margin-bottom: 10px;">Publicar Produtos no Catálogo</h3>
        <p style="font-size: 0.9em; margin-bottom: 15px; color: #007bff;">*Use este botão após salvar todas as alterações. O código deve ser copiado e submetido ao GitHub.</p>
        <button onclick="exportarProdutosParaCodigo()" style="background-color: #0056b3; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
            1. Gerar Código para Publicação
        </button>
        <div id="export-container" style="margin-top: 20px;">
            </div>
        <hr style="margin: 30px 0; border-top: 1px solid #ced4da;">

        <h3>Catálogo Atual (Incluindo Inativos)</h3>
        <div id="lista-produtos-admin">
            </div>

        <hr style="margin: 30px 0; border-top: 1px solid #ced4da;">
        
        <h2>Gerenciamento de Acesso</h2>
        <fieldset>
            <legend>Cadastrar Novo Administrador</legend>
            <div class="input-group">
                <label for="novo-login">Login (Username):</label>
                <input type="text" id="novo-login" placeholder="Ex: admin_joao">
            </div>
            <div class="input-group">
                <label for="nova-senha">Senha Inicial:</label>
                <input type="password" id="nova-senha" placeholder="********">
            </div>
            <button onclick="cadastrarNovoUsuario()" style="width: 100%;" class="btn-cadastro">Cadastrar Usuário</button>
        </fieldset>
        
        <hr style="margin: 30px 0; border-top: 1px solid #ced4da;">
        <fieldset>
            <legend>Redefinir Senha de Usuário Existente</legend>
            <div class="input-group">
                <label for="reset-login">Login do Usuário:</label>
                <input type="text" id="reset-login" placeholder="Digite o login existente">
            </div>
            <div class="input-group">
                <label for="reset-senha">Nova Senha:</label>
                <input type="password" id="reset-senha" placeholder="Nova senha">
            </div>
            <button onclick="redefinirSenha()" style="width: 100%;" class="btn-redefinir">Redefinir Senha</button>
            <p style="margin-top: 10px; color: #dc3545; font-size: 0.9em;">*Sem autenticação: A redefinição é imediata.</p>
        </fieldset>

        <button onclick="logout()" style="width: 100%; margin-top: 20px;">Sair do Painel</button>
    </div>

    <script>
        const STORAGE_KEY_PRODUTOS = 'produtosFarmacia'; 
        const STORAGE_KEY_USUARIOS = 'adminUsuarios'; 

        if (!localStorage.getItem(STORAGE_KEY_USUARIOS)) {
            const usuariosIniciais = [{ login: 'admin', senha: 'admin123' }];
            localStorage.setItem(STORAGE_KEY_USUARIOS, JSON.stringify(usuariosIniciais));
        }

        // --- Funções de Autenticação de Usuário (SEM ALTERAÇÃO) ---

        function carregarUsuarios() {
            const usuariosJSON = localStorage.getItem(STORAGE_KEY_USUARIOS);
            return usuariosJSON ? JSON.parse(usuariosJSON) : []; 
        }

        function salvarUsuarios(usuarios) {
            localStorage.setItem(STORAGE_KEY_USUARIOS, JSON.stringify(usuarios));
        }

        function fazerLogin() {
            const loginDigitado = document.getElementById('admin-login').value;
            const senhaDigitada = document.getElementById('admin-senha').value;
            const usuarios = carregarUsuarios();
            const usuarioEncontrado = usuarios.find(u => u.login === loginDigitado && u.senha === senhaDigitada);

            if (usuarioEncontrado) {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                renderizarProdutosAdmin();
            } else {
                alert('Login ou senha incorretos.');
            }
        }

        function logout() {
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('admin-login').value = '';
            document.getElementById('admin-senha').value = '';
            cancelarEdicao(); 
        }
        
        function cadastrarNovoUsuario() {
            const login = document.getElementById('novo-login').value.trim();
            const senha = document.getElementById('nova-senha').value.trim();

            if (!login || !senha) {
                alert('Preencha o login e a senha.');
                return;
            }

            let usuarios = carregarUsuarios();
            if (usuarios.some(u => u.login === login)) {
                alert(`O login '${login}' já existe.`);
                return;
            }

            usuarios.push({ login, senha });
            salvarUsuarios(usuarios);
            alert(`Usuário '${login}' cadastrado com sucesso!`);
            document.getElementById('novo-login').value = '';
            document.getElementById('nova-senha').value = '';
        }

        function redefinirSenha() {
            const login = document.getElementById('reset-login').value.trim();
            const novaSenha = document.getElementById('reset-senha').value.trim();
            if (!login || !novaSenha) {
                alert('Preencha o login e a nova senha.');
                return;
            }

            let usuarios = carregarUsuarios();
            const usuarioIndex = usuarios.findIndex(u => u.login === login);
            if (usuarioIndex === -1) {
                alert(`O login '${login}' não foi encontrado.`);
                return;
            }

            usuarios[usuarioIndex].senha = novaSenha;
            salvarUsuarios(usuarios);
            alert(`Senha do usuário '${login}' redefinida com sucesso.`);
            document.getElementById('reset-login').value = '';
            document.getElementById('reset-senha').value = '';
        }


        // --- Funções de Produtos (ALGUMAS ALTERAÇÕES) ---
        
        // Função modificada para NÃO dar alert de "Catálogo do cliente atualizado" e NÃO chamar renderizarProdutosAdmin() ao salvar usuários
        function salvarUsuarios(usuarios) {
            localStorage.setItem(STORAGE_KEY_USUARIOS, JSON.stringify(usuarios));
        }

        // Função renomeada para ser usada na exportação
        function carregarProdutosBase() {
            const produtosJSON = localStorage.getItem(STORAGE_KEY_PRODUTOS);
            const produtos = produtosJSON ? JSON.parse(produtosJSON) : []; 
            return produtos.map(p => ({
                ...p,
                status: p.status || 'ativo' // Adiciona status 'ativo' se não existir
            }));
        }

        function salvarProdutos(produtos) {
            localStorage.setItem(STORAGE_KEY_PRODUTOS, JSON.stringify(produtos));
            alert('Produtos atualizados e salvos no seu navegador! Agora, clique em "Gerar Código para Publicação" para tornar visível para todos.');
            renderizarProdutosAdmin();
            cancelarEdicao(); 
        }

        function renderizarProdutosAdmin() {
            const produtos = carregarProdutosBase(); // Usa a nova função
            const listaDiv = document.getElementById('lista-produtos-admin');
            listaDiv.innerHTML = '';

            if (produtos.length === 0) {
                listaDiv.innerHTML = '<p style="text-align: center;">Nenhum produto cadastrado.</p>';
                return;
            }

            produtos.forEach((produto, index) => {
                const urlImagem = produto.urlImagem || 'https://via.placeholder.com/50'; 
                const estoqueStatus = produto.estoque > 0 ? 
                    `<span style="color: #28a745; font-weight: bold;">Estoque: ${produto.estoque}</span>` :
                    `<span style="color: #dc3545; font-weight: bold;">ESTOQUE ZERADO</span>`;
                
                const statusInfo = produto.status === 'ativo' ? 
                    `<span style="color: #007bff; font-weight: bold;">(ATIVO)</span>` :
                    `<span style="color: #dc3545; font-weight: bold;">(INATIVO)</span>`;

                const div = document.createElement('div');
                if (produto.status === 'inativo') {
                    div.classList.add('inativo');
                }

                div.className = 'produto-admin';
                div.innerHTML = `
                    <div style="display: flex; align-items: center; flex-grow: 1;">
                        <img src="${urlImagem}" alt="${produto.nome}" style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px; border-radius: 4px;">
                        <span>
                            <strong>${produto.nome} ${statusInfo}</strong> 
                            (Cat.: ${produto.categoria}) - R$ ${produto.preco.toFixed(2)}
                            <br>
                            ${estoqueStatus}
                        </span>
                    </div>
                    <div class="admin-acoes">
                        <button class="btn-editar" onclick="editarProduto(${index})">Editar</button>
                        <button class="btn-remover" onclick="removerProdutoAdmin(${index})">Remover</button>
                    </div>
                `;
                listaDiv.appendChild(div);
            });
        }
        
        // ... (resto das funções de produto: preencherFormulario, limparFormulario, editarProduto, salvarEdicao, cancelarEdicao, adicionarProdutoAdmin, removerProdutoAdmin)
        // ... (continua com as mesmas funções do seu original)
        // ...

        // =========================================================
        // FUNÇÃO NOVA: EXPORTAR PRODUTOS PARA CÓDIGO JS
        // =========================================================

        function exportarProdutosParaCodigo() {
            // 1. Carrega a lista de produtos atual do localStorage
            const produtosAtuais = carregarProdutosBase(); 

            // 2. Transforma a lista de objetos em uma string JSON formatada
            // O 4 no final é para indentar (formatar) o JSON
            const produtosJSON = JSON.stringify(produtosAtuais, null, 4); 

            // 3. Monta o código JS completo para ser copiado
            const codigoPronto = `
// ====================================================================
// LISTA DE PRODUTOS PADRÃO (Gerada em ${new Date().toLocaleString()})
// COPIE TUDO ABAIXO DAQUI.
// ====================================================================
const PRODUTOS_PADRAO = ${produtosJSON};
    `;

            // 4. Cria um elemento para exibir e selecionar o código
            let container = document.getElementById('export-container');
            container.innerHTML = '<h3>2. Copie o texto completo da caixa:</h3>';

            const areaTexto = document.createElement('textarea');
            areaTexto.value = codigoPronto.trim(); // .trim() remove espaços em branco extras no início/fim
            areaTexto.style.width = '100%';
            areaTexto.style.height = '300px';
            areaTexto.style.marginTop = '10px';
            
            container.appendChild(areaTexto);

            // Seleciona o texto para facilitar a cópia
            areaTexto.select();
            areaTexto.setSelectionRange(0, 99999); // Para mobile
            
            alert("Código JavaScript gerado com sucesso! Copie o texto (Ctrl+C ou Cmd+C) e siga para o Passo 3: Colar no script.js e subir para o GitHub.");
        }

    </script>
    <footer>
                <div class="container">
                    <p>&copy; 2025 SistemasBPC. Todos os direitos reservados.</p>
                </div>
            </footer>

</body>
</html>